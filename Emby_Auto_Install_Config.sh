#!/bin/bash
echo **************************************************************************************************************
echo update and upgrade....
echo **************************************************************************************************************
sudo apt update && sudo apt upgrade && apt-get install unzip
echo **************************************************************************************************************
echo Fetching Emby Server....
echo **************************************************************************************************************
wget https://github.com/MediaBrowser/Emby.Releases/releases/download/4.6.4.0/emby-server-deb_4.6.4.0_amd64.deb
echo Installing Emby Server....
dpkg -i emby-server-deb_4.6.4.0_amd64.deb

echo **************************************************************************************************************
echo Pre-Requisites for Webmin...
echo **************************************************************************************************************
sudo apt install software-properties-common apt-transport-https wget -y
wget -q http://www.webmin.com/jcameron-key.asc -O- | sudo apt-key add -
sudo add-apt-repository "deb [arch=amd64] http://download.webmin.com/download/repository sarge contrib"
echo **************************************************************************************************************
echo Installing WebMin....
echo **************************************************************************************************************
sudo apt update && sudo apt install webmin -y

echo **************************************************************************************************************
echo Installing Fail2Ban.....
echo **************************************************************************************************************
sudo apt install fail2ban -y

echo **************************************************************************************************************
echo Fetching Configs....
echo **************************************************************************************************************
cd /tmp
wget https://github.com/captaintofuburger/emby-configs-open/archive/refs/heads/main.zip
unzip main.zip -d /tmp

echo **************************************************************************************************************
echo Stopping Fail2Ban Service....
echo **************************************************************************************************************
sudo systemctl stop fail2ban
cd /etc/fail2ban/
echo **************************************************************************************************************
echo replacing jail.local....
echo **************************************************************************************************************
rm jail.local
cp /tmp/emby-configs-open-main/jail.local /etc/fail2ban/jail.local
echo **************************************************************************************************************
echo adding Emby filter....
echo **************************************************************************************************************
cd /etc/fail2ban/filter.d/
cp /tmp/emby-configs-open-main/filter.d/emby.conf /etc/fail2ban/filter.d/emby.conf
echo **************************************************************************************************************
echo Adding Emby jail....
echo **************************************************************************************************************
cd /etc/fail2ban/jail.d/
cp /tmp/emby-configs-open-main/jail.d/emby.conf /etc/fail2ban/jail.d/emby.conf
echo **************************************************************************************************************
echo Configs Updated!
echo **************************************************************************************************************
echo Starting Fail2Ban....
echo **************************************************************************************************************
sudo systemctl start fail2ban

echo **************************************************************************************************************
echo **************************************************************************************************************
echo Emby Webmin and Fail2Ban should now be installed. Fail2Band is configured out of the box for sshd, webmin, and Emby
echo Emby will need manual setup to finish install
echo **************************************************************************************************************
echo **************************************************************************************************************
echo DONE!!!!!!!
echo **************************************************************************************************************
echo **************************************************************************************************************